<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chronos Website Downloader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #151537 0%, #23234d 50%, #1761a0 100%);
      overflow: hidden;
      position: relative;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
    }
    .background {
      position: absolute;
      top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0;
      pointer-events: none;
      opacity: 0.17;
    }
    .container {
      z-index: 1;
      background: rgba(36, 45, 90, 0.88);
      box-shadow: 0 8px 32px 0 rgba(31,38,135,0.37);
      border-radius: 20px;
      padding: 40px 32px 32px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 340px;
      max-width: 90vw;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.18);
    }
    h1 {
      color: #fff;
      font-weight: 700;
      margin-bottom: 18px;
      letter-spacing: 1.5px;
      font-size: 2rem;
      text-shadow: 0 2px 12px #1761a0;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    .input-group {
      display: flex;
      width: 100%;
      margin-bottom: 22px;
    }
    input[type="text"] {
      flex: 1;
      border: none;
      outline: none;
      padding: 14px 18px;
      font-size: 1.1rem;
      border-radius: 8px 0 0 8px;
      background: #23234d;
      color: #fff;
      box-shadow: 0 2px 10px #12122a44;
      transition: background 0.2s;
    }
    input[type="text"]:focus {
      background: #283f90;
    }
    button, .big-link-btn {
      padding: 0 30px;
      background: linear-gradient(90deg, #1761a0, #2fc7ff);
      color: #fff;
      border: none;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      box-shadow: 0 2px 10px #1761a055;
      transition: background 0.2s, transform 0.2s;
      text-decoration: none;
      display: inline-block;
      height: 48px;
      line-height: 48px;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    button:hover, .big-link-btn:hover {
      background: linear-gradient(90deg, #2fc7ff, #1761a0);
      transform: scale(1.04);
    }
    .actions {
      display: flex;
      gap: 12px;
      width: 100%;
      margin-bottom: 12px;
      justify-content: center;
    }
    .status {
      margin-top: 16px;
      font-size: 1rem;
      color: #ffb347;
      min-height: 30px;
      text-align: center;
      width: 100%;
    }
    .big-link-btn {
      width: 100%;
      padding: 24px 0;
      font-size: 1.5rem;
      font-weight: 700;
      margin-top: 30px;
      border-radius: 12px;
      background: linear-gradient(90deg, #2fc7ff 0%, #1761a0 100%);
      text-align: center;
      box-shadow: 0 4px 32px 0 #1761a055;
      letter-spacing: 2px;
    }
    /* Quick Settings styles - single color and white gear */
    #quick-settings-gear-btn {
      position: fixed;
      bottom: 32px;
      right: 32px;
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background: #1761a0;
      box-shadow: 0 4px 22px #1761a055;
      border: none;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s, transform 0.18s;
      outline: none;
    }
    #quick-settings-gear-btn:active,
    #quick-settings-gear-btn:focus-visible {
      background: #143e6d;
      transform: scale(0.97);
    }
    #quick-settings-gear-btn svg {
      width: 32px;
      height: 32px;
      fill: #fff;
      pointer-events: none;
      display: block;
    }
    #quick-settings-modal {
      display: none;
      position: fixed;
      z-index: 2500;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(18,22,44,0.32);
      justify-content: center;
      align-items: center;
    }
    #quick-settings-modal.active {
      display: flex;
    }
    #quick-settings-sheet {
      background: #1761a0;
      border-radius: 18px;
      box-shadow: 0 2px 28px #1761a044;
      border: 1.5px solid #1761a0;
      padding: 32px 32px 24px 32px;
      min-width: 270px;
      min-height: 90px;
      font-family: 'Montserrat', Arial, sans-serif;
      color: #fff;
      transition: top 0.2s;
      display: flex;
      flex-direction: column;
      gap: 22px;
      max-width: 96vw;
      position: relative;
      animation: quickSettingsIn 0.19s cubic-bezier(.7,1.8,.2,1) 1;
    }
    @keyframes quickSettingsIn {
      0% { opacity: 0; transform: translateY(22px) scale(0.97);}
      100% { opacity: 1; transform: none;}
    }
    #quick-settings-modal-close {
      position: absolute;
      top: 12px;
      right: 16px;
      background: none;
      border: none;
      color: #fff;
      font-size: 1.7rem;
      font-weight: 700;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.15s;
      z-index: 2;
    }
    #quick-settings-modal-close:hover {
      opacity: 1;
      color: #e0e6f0;
    }
    #quick-settings-sheet h2 {
      margin: 0 0 16px 0;
      font-size: 1.28rem;
      color: #fff;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-align: left;
    }
    .setting-row {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
      font-size: 1.08rem;
    }
    .setting-label {
      flex: 1;
      color: #fff;
    }
    .dropdown {
      position: relative;
      min-width: 130px;
    }
    .dropdown select {
      background: #232b40;
      color: #fff;
      border-radius: 8px;
      border: 1.5px solid #fff;
      font-size: 1.07rem;
      padding: 5px 20px 5px 9px;
      font-family: 'Montserrat', Arial, sans-serif;
      appearance: none;
      outline: none;
      transition: border 0.16s;
      box-shadow: 0 1px 4px #0002;
    }
    .dropdown:after {
      content: "â–¼";
      position: absolute;
      right: 12px; top: 8px;
      color: #fff;
      font-size: 0.75em;
      pointer-events: none;
    }
    @media (max-width: 400px) {
      .container { min-width: 90vw; padding: 18px 6vw; }
      h1 { font-size: 1.2rem; }
      button, input[type="text"], .big-link-btn { font-size: 0.99rem; }
      .big-link-btn { padding: 12px 0; }
      #quick-settings-gear-btn { width: 40px; height: 40px; }
      #quick-settings-gear-btn svg { width: 18px; height: 18px; }
    }
  </style>
</head>
<body>
  <svg class="background" viewBox="0 0 1440 900" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
    <defs>
      <linearGradient id="glow" x1="0" y1="0" x2="100%" y2="100%">
        <stop stop-color="#2fc7ff" stop-opacity="0.8"/>
        <stop offset="1" stop-color="#1761a0" stop-opacity="0.3"/>
      </linearGradient>
    </defs>
    <g>
      <path d="M0 100 Q360 180 720 100 T1440 100" stroke="url(#glow)" stroke-width="3" fill="none"/>
      <path d="M0 400 Q360 480 720 400 T1440 400" stroke="url(#glow)" stroke-width="2" fill="none"/>
      <path d="M0 700 Q360 780 720 700 T1440 700" stroke="url(#glow)" stroke-width="3" fill="none"/>
    </g>
  </svg>
  <div class="container">
    <h1>Chronos Website Downloader</h1>
    <form class="input-group" id="downloader-form" autocomplete="off">
      <input type="text" id="url-input" placeholder="Enter any GitHub Pages URL (https://...)" required />
      <button type="submit">Download</button>
    </form>
    <div class="actions">
      <button id="open-chronos" type="button" style="display:none;">Open as Chronos</button>
      <button id="open-direct" type="button" style="display:none;">Open Direct</button>
    </div>
    <div class="status" id="status"></div>
    <a class="big-link-btn" href="chronos-viewer.html" target="_blank">Open Chronos Viewer</a>
  </div>
  <!-- Quick Settings Gear Button -->
  <button id="quick-settings-gear-btn" title="Quick Settings" aria-label="Quick Settings">
    <svg viewBox="0 0 24 24">
      <path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.43-4.06l1.77-1.37a.5.5 0 0 0 .11-.66l-1.7-2.94a.5.5 0 0 0-.61-.23l-2.1.84a6.82 6.82 0 0 0-1.48-.86l-.32-2.24A.5.5 0 0 0 14 2h-4a.5.5 0 0 0-.5.43l-.32 2.24c-.52.2-1.01.47-1.48.86l-2.1-.84a.5.5 0 0 0-.61.23L2.7 7.41a.5.5 0 0 0 .11.66l1.77 1.37c-.05.32-.08.65-.08.99 0 .34.03.67.08.99l-1.77 1.37a.5.5 0 0 0-.11.66l1.7 2.94c.13.22.39.3.61.23l2.1-.84c.47.39.96.72 1.48.86l.32 2.24A.5.5 0 0 0 10 22h4c.26 0 .46-.18.5-.43l.32-2.24c.52-.2 1.01-.47 1.48-.86l2.1.84c.22.09.48-.01.61-.23l1.7-2.94a.5.5 0 0 0-.11-.66l-1.77-1.37c.05-.32.08-.65.08-.99 0-.34-.03-.67-.08-.99zM12 17a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
    </svg>
  </button>
  <!-- Quick Settings Modal (dropdown for premade cloaking) -->
  <div id="quick-settings-modal">
    <div id="quick-settings-sheet">
      <button id="quick-settings-modal-close" title="Close" aria-label="Close">&times;</button>
      <h2>Quick Settings</h2>
      <div class="setting-row">
        <span class="setting-label">Premade Cloaking</span>
        <span class="dropdown" style="display:flex;align-items:center;gap:8px;">
          <select id="premade-cloak-dropdown">
            <option value="off">Off</option>
            <option value="classroom">Google Classroom</option>
            <option value="sheets">Google Sheets</option>
            <option value="slides">Google Slides</option>
            <option value="docs">Google Docs</option>
            <option value="gmail">Gmail</option>
            <option value="powerschool">PowerSchool</option>
            <option value="studysync">StudySync</option>
            <option value="khan">Khan Academy</option>
            <option value="adobe">Adobe</option>
            <option value="powerpoint">PowerPoint</option>
            <option value="word">Microsoft Word</option>
            <option value="youtube">YouTube</option>
          </select>
          <button id="cloak-now-btn" type="button" style="padding:4px 15px;border-radius:6px;border:none;background:#fff;color:#1761a0;font-weight:700;cursor:pointer;">Cloak Now</button>
        </span>
      </div>
    </div>
  </div>
  <script>
    // Downloader logic (same as before)
    const form = document.getElementById('downloader-form');
    const urlInput = document.getElementById('url-input');
    const statusDiv = document.getElementById('status');
    const openChronosBtn = document.getElementById('open-chronos');
    const openDirectBtn = document.getElementById('open-direct');
    let lastUrl = '';

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusDiv.textContent = '';
      openChronosBtn.style.display = 'none';
      openDirectBtn.style.display = 'none';
      const url = urlInput.value.trim();
      lastUrl = url;
      if (!/^https?:\/\//i.test(url)) {
        statusDiv.textContent = 'Please enter a valid URL (must start with http:// or https://)';
        return;
      }
      statusDiv.textContent = 'Attempting download...';
      try {
        const resp = await fetch(url, { mode: 'cors' });
        if (!resp.ok) throw new Error('Failed to fetch. Status: ' + resp.status);
        const text = await resp.text();

        // Save as .chronos file
        const blob = new Blob([text], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = url.replace(/(^\w+:|^)\/\//, '').replace(/[\/\\\?%*:|"<>]/g, '_') + '.chronos';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        statusDiv.textContent = 'Download started! (If it failed, try "Open as Chronos")';
        openChronosBtn.style.display = '';
        openDirectBtn.style.display = '';
      } catch (err) {
        statusDiv.textContent = 'Could not download due to CORS or network error. Try "Open as Chronos" for live preview.';
        openChronosBtn.style.display = '';
        openDirectBtn.style.display = '';
      }
    });

    openChronosBtn.addEventListener('click', () => {
      if (!lastUrl) return;
      window.open('chronos-viewer.html#' + encodeURIComponent(lastUrl), '_blank', 'noopener');
    });
    openDirectBtn.addEventListener('click', () => {
      if (!lastUrl) return;
      window.open(lastUrl, '_blank', 'noopener');
    });

    // Quick Settings & Cloak logic
    const cloakData = {
      off: {
        title: "Chronos Website Downloader",
        favicon: "favicon.ico"
      },
      classroom: {
        title: "Classes",
        favicon: "https://ssl.gstatic.com/classroom/ic_product_classroom_32.png"
      },
      sheets: {
        title: "Untitled spreadsheet - Google Sheets",
        favicon: "https://ssl.gstatic.com/docs/spreadsheets/favicon3.ico"
      },
      slides: {
        title: "Untitled presentation - Google Slides",
        favicon: "https://ssl.gstatic.com/docs/presentations/images/favicon5.ico"
      },
      docs: {
        title: "Untitled document - Google Docs",
        favicon: "https://ssl.gstatic.com/docs/doclist/images/infinite_arrow_favicon_5.ico"
      },
      gmail: {
        title: "Inbox (1) - user@gmail.com - Gmail",
        favicon: "https://ssl.gstatic.com/ui/v1/icons/mail/rfr/gmail.ico"
      },
      powerschool: {
        title: "PowerSchool",
        favicon: "https://www.powerschool.com/favicon.ico"
      },
      studysync: {
        title: "StudySync",
        favicon: "https://www.studysync.com/favicon.ico"
      },
      khan: {
        title: "Dashboard | Khan Academy",
        favicon: "https://www.khanacademy.org/favicon.ico"
      },
      adobe: {
        title: "Adobe Document Cloud",
        favicon: "https://www.adobe.com/favicon.ico"
      },
      powerpoint: {
        title: "Presentation1 - PowerPoint",
        favicon: "https://static-00.iconduck.com/assets.00/microsoft-powerpoint-icon-512x512-zik0v4o4.png"
      },
      word: {
        title: "Document1 - Word",
        favicon: "https://static-00.iconduck.com/assets.00/microsoft-word-icon-512x512-zfhk9u2d.png"
      },
      youtube: {
        title: "YouTube",
        favicon: "https://www.youtube.com/s/desktop/6f3f9f34/img/favicon.ico"
      }
    };

    function setCloak(cloakKey) {
      const cloak = cloakData[cloakKey] || cloakData['off'];
      document.title = cloak.title;
      let link = document.querySelector("link[rel~='icon']");
      if (!link) {
        link = document.createElement('link');
        link.rel = 'icon';
        document.head.appendChild(link);
      }
      link.href = cloak.favicon;
    }
    const CLOAK_KEY = "ion-premade-cloak";
    const gearBtn = document.getElementById('quick-settings-gear-btn');
    const modal = document.getElementById('quick-settings-modal');
    const closeBtn = document.getElementById('quick-settings-modal-close');
    const cloakDropdown = document.getElementById('premade-cloak-dropdown');
    const cloakNowBtn = document.getElementById("cloak-now-btn");

    function loadCloakSetting() {
      let val = localStorage.getItem(CLOAK_KEY) || "off";
      cloakDropdown.value = val;
      setCloak(val);
    }
    // On page load, restore last-used cloak
    window.addEventListener("DOMContentLoaded", function() {
      loadCloakSetting();
    });
    cloakDropdown.addEventListener("change", function() {
      localStorage.setItem(CLOAK_KEY, cloakDropdown.value);
      window.dispatchEvent(new Event("ionSettingsChanged"));
      setCloak(cloakDropdown.value);
    });
    window.addEventListener("storage", function(e) {
      if (e.key === CLOAK_KEY) loadCloakSetting();
    });
    window.addEventListener("ionSettingsChanged", function() {
      loadCloakSetting();
    });
    cloakNowBtn.onclick = function() {
      const cloakKey = cloakDropdown.value;
      setCloak(cloakKey);
      localStorage.setItem(CLOAK_KEY, cloakKey);
    };
    gearBtn.onclick = function() { modal.classList.add('active'); };
    closeBtn.onclick = function() { modal.classList.remove('active'); };
    modal.addEventListener('mousedown', function(e) {
      if (e.target === modal) modal.classList.remove('active');
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === "Escape" && modal.classList.contains('active')) {
        modal.classList.remove('active');
      }
    });
  </script>
</body>
</html>

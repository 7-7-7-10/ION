<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ION Game Vault</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Montserrat for the title -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
  <style>
    :root {
      --theme-hue: 210;
      --theme-accent: hsl(var(--theme-hue), 100%, 56%);
      --theme-accent-light: hsl(var(--theme-hue), 100%, 72%);
      --theme-accent-dark: hsl(var(--theme-hue), 72%, 36%);
      --theme-bg: #0a0f2c;
    }
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: var(--theme-bg);
      color: #e0e6f0;
      font-family: 'Montserrat', Arial, sans-serif;
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
    }
    #vanta-bg {
      position: fixed;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      z-index: 0;
      pointer-events: none;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 100px;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }
    .container {
      max-width: 960px;
      width: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }
    h1 {
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 900;
      font-size: clamp(1.3rem, 7vw, 4.2rem);
      max-width: 100vw;
      letter-spacing: clamp(0.03em, 3vw, 0.18em);
      background: linear-gradient(90deg, var(--theme-accent), var(--theme-accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      margin: 0 0 32px 0;
      text-align: center;
      user-select: none;
      white-space: nowrap;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      border: none;
      box-shadow: none;
      padding: 0;
      text-shadow: none;
      overflow-x: auto;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: clamp(1rem, 6vw, 2.3rem);
        margin-bottom: 28px;
        white-space: normal;
        word-break: break-word;
      }
    }
    /* Navigation Bar Styles */
    .navbar {
      position: fixed;
      top: 18px;
      right: 32px;
      z-index: 1002;
      background: rgba(10, 15, 44, 0.95);
      border-radius: 14px;
      box-shadow: 0 2px 16px var(--theme-accent-dark, #1e90ff33);
      border: 1.5px solid var(--theme-accent-dark, #1e90ff44);
      padding: 8px 20px 8px 16px;
      display: flex;
      align-items: center;
      gap: 18px;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    .navbar a {
      text-decoration: none;
      color: var(--theme-accent-light);
      font-weight: 600;
      font-size: 1.09rem;
      letter-spacing: 0.04em;
      transition: color 0.16s, text-shadow 0.16s;
      padding: 3px 10px;
      border-radius: 10px;
      position: relative;
    }
    .navbar a:hover, .navbar a:focus-visible {
      color: #fff;
      background: var(--theme-accent);
      text-shadow: 0 0 8px var(--theme-accent-light), 0 0 2px #fff;
      outline: none;
    }
    .navbar .nav-logo {
      font-size: 1.2em;
      font-weight: 700;
      color: var(--theme-accent);
      background: none;
      cursor: pointer;
      padding: 0 10px 0 0;
      letter-spacing: 0.08em;
      text-shadow: 0 0 8px var(--theme-accent-light);
      border: none;
    }
    .status-widget {
      position: fixed;
      top: 18px;
      left: 32px;
      transform: none;
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 8px 14px;
      background: rgba(10, 15, 44, 0.92);
      border-radius: 14px;
      box-shadow: 0 2px 16px var(--theme-accent-dark, #1e90ff33);
      font-size: 1.1rem;
      color: var(--theme-accent-light);
      z-index: 1000;
      border: 1.5px solid var(--theme-accent-dark, #1e90ff44);
      font-family: 'Montserrat', Arial, sans-serif;
      user-select: none;
      min-width: 220px;
      justify-content: center;
    }
    .status-widget span {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    #battery-icon svg, #wifi-icon svg {
      display: inline-block;
      vertical-align: middle;
      height: 1.2em;
      width: 1.2em;
    }
    .color-btns {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-left: 6px;
    }
    .color-btn {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      border: 2px solid #fff;
      box-shadow: 0 0 2px #0003;
      cursor: pointer;
      outline: none;
      transition: border 0.16s, box-shadow 0.16s;
      position: relative;
      background: #fff;
      display: inline-block;
      padding: 0;
    }
    .color-btn.selected, .color-btn:focus-visible {
      border: 2.5px solid var(--theme-accent);
      box-shadow: 0 0 0 2px var(--theme-accent-light);
      z-index: 2;
    }
    .color-btn[data-hue="210"] { background: hsl(210,100%,56%); }
    .color-btn[data-hue="0"]   { background: hsl(0,100%,56%); }
    .color-btn[data-hue="30"]  { background: hsl(30,100%,56%); }
    .color-btn[data-hue="50"]  { background: hsl(50,100%,56%); }
    .color-btn[data-hue="120"] { background: hsl(120,100%,40%); }
    .color-btn[data-hue="180"] { background: hsl(180,100%,40%); }
    .color-btn[data-hue="270"] { background: hsl(270,100%,60%); }
    .color-btn[data-hue="320"] { background: hsl(320,100%,60%); }
    .color-btn[data-hue="220"] { background: hsl(220,10%,52%); }
    .color-btn::after {
      content: '';
      display: block;
      width: 100%;
      height: 100%;
      border-radius: 6px;
      border: 2px solid #fff0;
      position: absolute;
      left: 0; top: 0;
      pointer-events: none;
    }
    .scroll-area {
      width: 100%;
      max-width: 900px;
      height: 700px;
      overflow-y: auto;
      position: relative;
      margin-bottom: 32px;
      scrollbar-width: thin;
      scrollbar-color: var(--theme-accent) var(--theme-bg);
      padding-bottom: 40px;
    }
    .scroll-area::-webkit-scrollbar {
      width: 14px;
      background: var(--theme-bg);
      border-radius: 8px;
    }
    .scroll-area::-webkit-scrollbar-thumb {
      background: linear-gradient(var(--theme-accent), var(--theme-accent-light) 70%);
      border-radius: 8px;
      border: 3px solid var(--theme-bg);
      box-shadow: 0 0 8px var(--theme-accent-dark);
    }
    .scroll-area::-webkit-scrollbar-thumb:hover {
      background: var(--theme-accent-light);
    }
    .scroll-area::-webkit-scrollbar-corner {
      background: var(--theme-bg);
    }
    .scroll-percent {
      position: absolute;
      top: 12px;
      right: -44px;
      width: 40px;
      background: rgba(10, 15, 44, 0.85);
      color: var(--theme-accent-light);
      font-weight: 700;
      font-size: 1.2rem;
      border-radius: 12px;
      box-shadow: 0 0 8px var(--theme-accent-dark);
      text-align: center;
      padding: 6px 0;
      pointer-events: none;
      user-select: none;
      z-index: 10;
      transition: top 0.15s cubic-bezier(.4,2,.6,1);
    }
    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 28px;
      width: 100%;
      padding-right: 18px;
      box-sizing: border-box;
    }
    .game-button {
      background: rgba(20, 30, 60, 0.93);
      border: 2.5px solid var(--theme-accent);
      border-radius: 16px;
      height: 140px;
      cursor: pointer;
      transition: 
        background 0.25s cubic-bezier(.4,2,.6,1),
        box-shadow 0.25s cubic-bezier(.4,2,.6,1),
        border-color 0.18s,
        color 0.18s,
        transform 0.18s;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--theme-accent-light);
      font-weight: 700;
      font-size: 1.3rem;
      letter-spacing: 0.08em;
      user-select: none;
      text-decoration: none;
      box-shadow: 0 0 12px var(--theme-accent-dark);
      outline: none;
      position: relative;
      overflow: hidden;
    }
    .game-button-canvas {
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
      display: block;
    }
    .game-button-content {
      position: relative;
      z-index: 1;
      width: 100%;
      text-align: center;
    }
    .game-button::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 14px;
      border: 2.5px solid transparent;
      transition: border-color 0.2s;
      pointer-events: none;
    }
    .game-button:hover,
    .game-button:focus {
      background: #111a2e;
      color: #fff;
      border-color: var(--theme-accent-light);
      box-shadow: 0 0 24px var(--theme-accent), 0 0 0 4px var(--theme-accent-dark);
      transform: translateY(-5px) scale(1.04);
      z-index: 1;
    }
    .game-button:hover::before,
    .game-button:focus::before {
      border-color: var(--theme-accent-light);
      box-shadow: 0 0 20px var(--theme-accent-light);
    }
    @media (max-width: 600px) {
      .scroll-area {
        height: 400px;
        padding-bottom: 30px;
      }
      body {
        padding-top: 60px;
      }
      h1 {
        font-size: clamp(1.1rem, 7vw, 2.3rem);
        margin-bottom: 28px;
        white-space: normal;
        word-break: break-word;
      }
      .game-button {
        height: 90px;
        font-size: 1rem;
      }
      .game-grid {
        gap: 16px;
      }
      .scroll-percent {
        font-size: 1rem;
        width: 32px;
        right: -36px;
      }
      .status-widget {
        font-size: 0.98rem;
        padding: 6px 10px;
        gap: 8px;
        min-width: 140px;
        left: 8px;
        top: 8px;
      }
      .color-btn {
        width: 15px;
        height: 15px;
        border-radius: 4px;
      }
      .navbar {
        top: 8px;
        right: 8px;
        padding: 5px 7px 5px 8px;
        border-radius: 10px;
        font-size: 0.98rem;
        gap: 10px;
      }
      .navbar a {
        padding: 3px 6px;
        font-size: 0.95rem;
      }
    }
    /* Custom Dialog styles for alert */
    dialog[open] {
      border: none;
      border-radius: 16px;
      background: rgba(24,30,60,0.99);
      color: #e0e6fa;
      box-shadow: 0 8px 32px #0a0f2caa;
      min-width: 260px;
      max-width: 94vw;
      padding: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      z-index: 9999;
      animation: dialogIn 0.18s cubic-bezier(.4,2,.6,1);
    }
    @keyframes dialogIn {
      from { transform: scale(0.88); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .custom-alert-content {
      padding: 32px 28px 18px 28px;
      text-align: center;
    }
    .custom-alert-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--theme-accent-light);
      margin-bottom: 9px;
      letter-spacing: 0.05em;
    }
    .custom-alert-message {
      margin-bottom: 18px;
      color: #b2cdfa;
      font-size: 1.08rem;
    }
    .custom-alert-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .custom-alert-checkbox-label {
      font-size: 1rem;
      color: #b2cdfa;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      user-select: none;
    }
    .custom-alert-btns {
      display: flex;
      justify-content: center;
      gap: 20px;
      padding-bottom: 22px;
    }
    .custom-alert-btn {
      font-family: inherit;
      font-weight: 700;
      letter-spacing: 0.04em;
      border: none;
      border-radius: 8px;
      padding: 8px 26px;
      background: var(--theme-accent);
      color: #fff;
      cursor: pointer;
      font-size: 1.03rem;
      box-shadow: 0 2px 14px #1e90ff66;
      transition: background 0.14s, box-shadow 0.16s;
    }
    .custom-alert-btn:active {
      background: var(--theme-accent-dark);
      box-shadow: 0 1px 8px #1e90ff44;
    }
    .custom-alert-toggle-label {
      background: rgba(55,90,140,0.17);
      color: var(--theme-accent);
      font-weight: 700;
      font-size: 1.09rem;
      justify-content: flex-start;
      gap: 8px;
      padding-left: 9px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
  </style>
</head>
<body>
  <div id="vanta-bg"></div>
  <!-- Navigation Bar -->
  <nav class="navbar" id="navbar">
    <span class="nav-logo" tabindex="0" title="ION Game Vault Home">ION</span>
    <a href="index.html" tabindex="0">Home</a>
    <a href="G@MES.html" tabindex="0">Games</a>
    <a href="PR0XIES.html" tabindex="0">Proxies</a>
    <a href="AI.html" tabindex="0">AI</a>
    <a href="#" tabindex="0">About</a>
    <a href="#" tabindex="0">Contact</a>
    <a href="Settings.html" tabindex="0">Settings</a>
  </nav>
  <!-- Status widget is now at top left -->
  <div class="status-widget" id="status-widget">
    <span id="battery-icon" title="Battery"></span>
    <span id="wifi-icon" title="Network"></span>
    <span id="datetime"></span>
    <span class="color-btns" id="color-btns" title="Theme Color">
      <button class="color-btn selected" data-hue="210" aria-label="Default Blue"></button>
      <button class="color-btn" data-hue="0" aria-label="Red"></button>
      <button class="color-btn" data-hue="30" aria-label="Orange"></button>
      <button class="color-btn" data-hue="50" aria-label="Yellow"></button>
      <button class="color-btn" data-hue="120" aria-label="Green"></button>
      <button class="color-btn" data-hue="180" aria-label="Cyan"></button>
      <button class="color-btn" data-hue="270" aria-label="Purple"></button>
      <button class="color-btn" data-hue="320" aria-label="Pink"></button>
      <button class="color-btn" data-hue="220" aria-label="Gray"></button>
    </span>
  </div>
  <div class="container">
    <h1>ION GAME VAULT</h1>
    <!-- Custom Alert Toggle -->
    <div class="custom-alert-toggle-label" style="margin-bottom: 20px;">
      <input type="checkbox" id="show-custom-alert">
      Show Custom Alert
    </div>
    <div class="scroll-area" id="scroll-area">
      <div class="scroll-percent" id="scroll-percent">0%</div>
      <div class="game-grid">
        <!-- Game Buttons -->
        <a href="games.html/CookieClicker.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Cookie Clicker</span></a>
        <a href="games.html/DriveMad.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Drive Mad</span></a>
        <a href="games.html/bobtherobber2.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Bob the Robber 2</span></a>
        <a href="games.html/BubbleTanks2.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Bubble Tanks 2</span></a>
        <a href="games.html/GeometryDash.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Geometry Dash</span></a>
        <a href="games.html/LearnToFly.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Learn to Fly</span></a>
        <a href="games.html/LearnToFly2.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Learn to Fly 2</span></a>
        <a href="games.html/MotoX3M.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">MotoX3M</span></a>
        <a href="games.html/MotoX3M-Pool.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">MotoX3M Pool Party</span></a>
        <a href="games.html/MotoX3m-Winter.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">MotoX3M WInter</span></a>
        <a href="games.html/MotoX3M-Spooky.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">MotoX3M Spooky</span></a>
        <a href="games.html/Minecraft1.5.2" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Minecraft 1.5.2</span></a>
        <a href="games.html/Minecraft1.8.8" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Minecraft 1.8.8</span></a>
        <a href="games.html/BobTheRobber4.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Bob the Robber 4</span></a>
        <a href="games.html/Drift boss.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Drift Boss</span></a>
        <a href="games.html/Slope.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Slope</span></a>
        <a href="games.html/Slope2.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Slope 2</span></a>
        <a href="games.html/HelixJump.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Helix Jump</span></a>
        <a href="games.html/TunnelRush.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Tunnel Rush</span></a>
        <a href="games.html/ChromeDino.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Chrome://Dino</span></a>
        <a href="games.html/Run3.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Run3</span></a>
        <a href="games.html/ClusterRush.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Cluster Rush</span></a>
        <a href="games.html/MonkeyMart.html" class="game-button"><canvas class="game-button-canvas"></canvas><span class="game-button-content">Monkey Mart</span></a>
        <!-- ...add remaining games as needed... -->
      </div>
    </div>
  </div>
  <!-- Custom Alert Dialog -->
  <dialog id="custom-alert-dialog">
    <form method="dialog" class="custom-alert-content">
      <div class="custom-alert-title">Notice</div>
      <div class="custom-alert-message">This is a custom alert dialog!<br>You can toggle its appearance in settings.</div>
      <div class="custom-alert-controls">
        <label class="custom-alert-checkbox-label">
          <input type="checkbox" id="block-future-dialogs">
          Don't allow this page to create any additional dialogs
        </label>
      </div>
      <div class="custom-alert-btns">
        <button value="ok" class="custom-alert-btn">OK</button>
      </div>
    </form>
  </dialog>
  <!-- VANTA.NET JS (requires three.js) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
  <script>
    // --- Theme color from localStorage ---
    function loadSetting(key, def) {
      let v = localStorage.getItem(key);
      return v === null ? def : JSON.parse(v);
    }
    // Theme
    let themeColor = loadSetting('themeColor', '#2196f3');
    document.documentElement.style.setProperty('--theme-accent', themeColor);

    // --- Vanta background enable/disable from localStorage ---
    let vantaEnabled = loadSetting('enableVanta', true);
    document.getElementById('vanta-bg').style.display = vantaEnabled ? '' : 'none';

    // Vanta background
    function rand(min, max) { return Math.random() * (max - min) + min; }
    let vantaEffect;
    function setVantaTheme(hex) {
      if (vantaEffect) vantaEffect.destroy();
      vantaEffect = VANTA.NET({
        el: "#vanta-bg",
        mouseControls: false,
        touchControls: false,
        gyroControls: false,
        minHeight: 200.00,
        minWidth: 200.00,
        scale: 1.00,
        scaleMobile: 1.00,
        color: hex,
        backgroundColor: 0x0a0f2c,
        points: rand(10, 20),
        maxDistance: rand(18, 30),
        spacing: rand(15, 28)
      });
    }
    setVantaTheme(themeColor);

    // Color button logic (for preview only, doesn't persist)
    const colorBtns = document.querySelectorAll('.color-btn');
    colorBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        colorBtns.forEach(b => b.classList.remove('selected'));
        this.classList.add('selected');
        const hue = this.getAttribute('data-hue');
        let color = `hsl(${hue},100%,56%)`;
        document.documentElement.style.setProperty('--theme-hue', hue);
        document.documentElement.style.setProperty('--theme-accent', color);
        setVantaTheme(color);
        updateWifiIcon();
        updateBatteryIcon(lastBatteryLevel, lastBatteryCharging);
      });
    });

    // --- Feature toggles for the page ---
    function featureEnabled(key, def) { return loadSetting(key, def); }
    // Particles
    let particlesEnabled = featureEnabled('enableParticles', true);
    // Status widget
    let statusWidgetEnabled = featureEnabled('enableStatusWidget', true);
    document.getElementById('status-widget').style.display = statusWidgetEnabled ? '' : 'none';
    // Scroll percent
    let scrollPercentEnabled = featureEnabled('enableScrollPercent', true);
    document.getElementById('scroll-percent').style.display = scrollPercentEnabled ? '' : 'none';

    // Scroll percentage indicator logic
    const scrollArea = document.getElementById('scroll-area');
    const scrollPercent = document.getElementById('scroll-percent');
    function updateScrollPercent() {
      const scrollTop = scrollArea.scrollTop;
      const scrollHeight = scrollArea.scrollHeight - scrollArea.clientHeight;
      const percent = scrollHeight === 0 ? 100 : Math.round((scrollTop / scrollHeight) * 100);
      scrollPercent.textContent = percent + '%';
      // Move the indicator along with the thumb
      const maxTop = scrollArea.clientHeight - scrollPercent.offsetHeight - 12;
      scrollPercent.style.top = (12 + maxTop * (percent / 100)) + 'px';
    }
    scrollArea.addEventListener('scroll', updateScrollPercent);
    window.addEventListener('load', updateScrollPercent);
    window.addEventListener('resize', updateScrollPercent);

    // Status widget (battery, wifi, date/time)
    function updateDateTime() {
      const now = new Date();
      const dateStr = now.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: '2-digit' });
      const timeStr = now.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
      document.getElementById('datetime').textContent = `${dateStr} ${timeStr}`;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Battery API
    let lastBatteryLevel = 1, lastBatteryCharging = false;
    function updateBatteryIcon(level, charging) {
      lastBatteryLevel = level;
      lastBatteryCharging = charging;
      let percent = Math.round(level * 100);
      let fill = `hsl(${getComputedStyle(document.documentElement).getPropertyValue('--theme-hue')},100%,56%)`;
      let bolt = charging ? `<polygon points="13,7 11,13 15,13 11,19" fill="#ffe066"/>` : '';
      document.getElementById('battery-icon').innerHTML =
        `<svg viewBox="0 0 24 24">
          <rect x="2" y="7" width="16" height="10" rx="3" fill="none" stroke="${fill}" stroke-width="2"/>
          <rect x="3.5" y="8.5" width="${13 * level}" height="7" rx="2" fill="${fill}" opacity="0.7"/>
          <rect x="18" y="10" width="2.5" height="4" rx="1" fill="${fill}" stroke="none"/>
          ${bolt}
        </svg> ${percent}%`;
    }
    if ('getBattery' in navigator) {
      navigator.getBattery().then(function(battery) {
        function updateAllBattery() {
          updateBatteryIcon(battery.level, battery.charging);
        }
        battery.addEventListener('levelchange', updateAllBattery);
        battery.addEventListener('chargingchange', updateAllBattery);
        updateAllBattery();
      });
    } else {
      // Fallback for unsupported browsers
      document.getElementById('battery-icon').innerHTML =
        `<svg viewBox="0 0 24 24"><rect x="2" y="7" width="16" height="10" rx="3" fill="none" stroke="#444" stroke-width="2"/><rect x="18" y="10" width="2.5" height="4" rx="1" fill="#444" stroke="none"/></svg> N/A`;
    }

    // Network status
    function updateWifiIcon() {
      let online = navigator.onLine;
      let hue = getComputedStyle(document.documentElement).getPropertyValue('--theme-hue');
      let color = online ? `hsl(${hue},100%,72%)` : "#ffb347";
      let icon = online
        ? `<svg viewBox="0 0 24 24">
            <path d="M2 9.5Q12 2 22 9.5" fill="none" stroke="${color}" stroke-width="2"/>
            <path d="M6 13.5Q12 9 18 13.5" fill="none" stroke="${color}" stroke-width="2"/>
            <circle cx="12" cy="18" r="2" fill="${color}" />
          </svg> Online`
        : `<svg viewBox="0 0 24 24">
            <path d="M2 9.5Q12 2 22 9.5" fill="none" stroke="${color}" stroke-width="2"/>
            <path d="M6 13.5Q12 9 18 13.5" fill="none" stroke="${color}" stroke-width="2"/>
            <circle cx="12" cy="18" r="2" fill="${color}" />
            <line x1="4" y1="20" x2="20" y2="4" stroke="#ffb347" stroke-width="2"/>
          </svg> Offline`;
      document.getElementById('wifi-icon').innerHTML = icon;
    }
    window.addEventListener('online', updateWifiIcon);
    window.addEventListener('offline', updateWifiIcon);
    updateWifiIcon();

    // --- Particle Animation for Game Buttons ---
    function animateGameButtonParticles() {
      if (!particlesEnabled) return;
      document.querySelectorAll('.game-button').forEach(btn => {
        let canvas = btn.querySelector('.game-button-canvas');
        let w = btn.clientWidth, h = btn.clientHeight;
        canvas.width = w;
        canvas.height = h;
        let ctx = canvas.getContext('2d');
        let pCount = Math.floor(rand(3, 6));
        let particles = [];
        for (let i = 0; i < pCount; ++i) {
          particles.push({
            x: rand(w * 0.15, w * 0.85),
            y: rand(0, h),
            r: rand(3, 7),
            a: rand(0.15, 0.28),
            v: rand(0.14, 0.24),
            hue: 210 // blue
          });
        }
        function drawParticles() {
          ctx.clearRect(0, 0, w, h);
          let hue = getComputedStyle(document.documentElement).getPropertyValue('--theme-hue') || 210;
          for (let p of particles) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
            ctx.fillStyle = `hsla(${hue},100%,65%,${p.a})`;
            ctx.shadowColor = `hsla(${hue},100%,65%,0.25)`;
            ctx.shadowBlur = 8;
            ctx.fill();
            ctx.shadowBlur = 0;
            p.y += p.v;
            if (p.y - p.r > h) {
              p.y = -p.r;
              p.x = rand(w * 0.15, w * 0.85);
            }
          }
          requestAnimationFrame(drawParticles);
        }
        drawParticles();
      });
    }
    if (particlesEnabled) {
      window.addEventListener('load', animateGameButtonParticles);
      window.addEventListener('resize', animateGameButtonParticles);
      colorBtns.forEach(btn => btn.addEventListener('click', animateGameButtonParticles));
    }

    // --- Cloaking on blur ---
    let cloakOnBlur = featureEnabled('cloakOnBlur', false);
    let cloakTitle = loadSetting('cloakTitle', '');
    let cloakFavicon = loadSetting('cloakFavicon', '');
    let originalTabTitle = document.title;
    let originalFavicon = (function() {
      let link = document.querySelector("link[rel~='icon']");
      return link ? link.href : '';
    })();
    function setTabTitle(title) {
      if(title.trim() !== "") document.title = title;
    }
    function setFavicon(url) {
      let link = document.querySelector("link[rel~='icon']");
      if(!link) {
        link = document.createElement('link');
        link.rel = 'icon';
        document.head.appendChild(link);
      }
      link.href = url;
    }
    function cloakTab() {
      if (cloakTitle.trim() !== "") document.title = cloakTitle;
      if (cloakFavicon.trim() !== "") setFavicon(cloakFavicon);
    }
    function uncloakTab() {
      document.title = originalTabTitle;
      setFavicon(originalFavicon);
    }
    function handleVisibilityChange() {
      if (cloakOnBlur) {
        if (document.hidden) {
          cloakTab();
        } else {
          uncloakTab();
        }
      }
    }
    document.addEventListener("visibilitychange", handleVisibilityChange);
    // On page load, if on-blur is set and we're hidden, cloak immediately
    if (cloakOnBlur && document.hidden) cloakTab();

    // --- Custom Alert Dialog logic ---
    const showAlertToggle = document.getElementById('show-custom-alert');
    const customAlertDialog = document.getElementById('custom-alert-dialog');
    const blockDialogsCheckbox = document.getElementById('block-future-dialogs');
    // Persist blockDialogs in localStorage
    let blockDialogs = loadSetting('blockCustomDialogs', false);
    blockDialogsCheckbox.checked = blockDialogs;
    blockDialogsCheckbox.addEventListener('change', function() {
      blockDialogs = this.checked;
      localStorage.setItem('blockCustomDialogs', JSON.stringify(blockDialogs));
    });
    function maybeShowDialog() {
      let show = loadSetting('showCustomAlert', false);
      if (showAlertToggle) showAlertToggle.checked = show;
      if (show && !blockDialogs) {
        if (!customAlertDialog.open) {
          customAlertDialog.showModal();
        }
      } else {
        if (customAlertDialog.open) {
          customAlertDialog.close();
        }
      }
    }
    // Load & react to toggle
    showAlertToggle.checked = loadSetting('showCustomAlert', false);
    showAlertToggle.addEventListener('change', function() {
      localStorage.setItem('showCustomAlert', JSON.stringify(this.checked));
      maybeShowDialog();
    });
    // Dialog close (user presses OK)
    customAlertDialog.addEventListener('close', function() {
      maybeShowDialog();
    });
    // Show/hide dialog on load, and if blocking state changes
    maybeShowDialog();
    blockDialogsCheckbox.addEventListener('change', maybeShowDialog);
  </script>
</body>
</html>

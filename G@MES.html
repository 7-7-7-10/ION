<!-- ... all previous code remains the same up to the popup ... -->
  <button class="settings-fab" id="settings-fab" title="Quick Cloak Settings">
    <svg width="30" height="30" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" stroke="white" stroke-width="2"/><path d="M12 8v4m0 4h.01" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
  </button>
  <div class="settings-popup" id="settings-popup">
    <div class="settings-popup-header">
      <span class="settings-popup-title">Quick Cloak Settings</span>
      <button class="settings-popup-close" id="settings-popup-close" title="Close">&times;</button>
    </div>
    <div class="settings-popup-content">
      <div class="popup-cloak-group">
        <label class="premade-cloak-label" for="popup-premade-cloak">
          Premade Tab Cloak:
          <select id="popup-premade-cloak" class="premade-cloak-select">
            <option value="">Choose...</option>
            <option value="classroom">Google Classroom</option>
            <option value="slides">Google Slides</option>
            <option value="docs">Google Docs</option>
            <option value="sheets">Google Sheets</option>
            <option value="adobe">Adobe</option>
            <option value="googlenewtab">Google New Tab</option>
            <option value="bingnewtab">Bing New Tab</option>
            <option value="kahoot">Kahoot</option>
            <option value="quizzez">Quizzez</option>
            <option value="sora">Sora</option>
            <option value="aboutblank">Fake about:blank</option>
          </select>
        </label>
      </div>
      <div class="popup-switch-row">
        Clickoff Cloaking
        <span class="switch">
          <input type="checkbox" id="popup-cloak-on-blur">
          <span class="slider"></span>
        </span>
      </div>
      <div class="popup-switch-row">
        Confirm Before Exit
        <span class="switch">
          <input type="checkbox" id="popup-beforeunload-toggle">
          <span class="slider"></span>
        </span>
      </div>
      <div style="margin-top: 8px;">
        <label style="font-size:1.07rem;color:var(--theme-accent-light);font-weight:600;">
          Panic Key:
          <input id="panic-key-input" type="text" maxlength="1" style="width:36px;text-align:center;font-size:1.1rem;margin-left:7px;border-radius:6px;border:1.5px solid #385599;background:#232d48;color:#d1e5ff;" autocomplete="off" />
        </label>
        <label style="margin-left:16px;font-size:1.07rem;color:var(--theme-accent-light);font-weight:600;">
          URL:
          <input id="panic-url-input" type="text" placeholder="https://example.com" style="width:140px;font-size:1.05rem;margin-left:7px;border-radius:6px;border:1.5px solid #385599;background:#232d48;color:#d1e5ff;" autocomplete="off" />
        </label>
      </div>
      <div style="font-size:0.98rem;color:#98b6ea;margin-top:4px;margin-left:2px;">
        Press your panic key anytime to instantly go to the specified site.
      </div>
    </div>
  </div>
  <!-- VANTA.NET JS (requires three.js) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
  <script>
    // ... previous script code remains above ...

    // --- Panic Key Logic ---
    function saveSetting(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }
    function loadSetting(key, def) {
      let v = localStorage.getItem(key);
      return v === null ? def : JSON.parse(v);
    }

    // Panic key and URL
    let panicKey = loadSetting('panicKey', '');
    let panicUrl = loadSetting('panicUrl', '');

    // Update inputs in UI
    const panicKeyInput = document.getElementById('panic-key-input');
    const panicUrlInput = document.getElementById('panic-url-input');
    if (panicKeyInput) panicKeyInput.value = panicKey;
    if (panicUrlInput) panicUrlInput.value = panicUrl;

    // Update storage and live value when user edits
    if (panicKeyInput) panicKeyInput.addEventListener('input', function() {
      panicKey = this.value.trim().toLowerCase();
      saveSetting('panicKey', panicKey);
    });
    if (panicUrlInput) panicUrlInput.addEventListener('input', function() {
      panicUrl = this.value.trim();
      saveSetting('panicUrl', panicUrl);
    });

    // Listen globally for panic key if set and URL present
    document.addEventListener('keydown', function(e) {
      // Ignore if in an input or textarea
      if (
        document.activeElement &&
        (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA')
      ) return;
      if (
        panicKey &&
        panicUrl &&
        e.key.toLowerCase() === panicKey
      ) {
        // Add http if missing, for user convenience
        let url = panicUrl;
        if (!/^https?:\/\//i.test(url) && !/^\/\//.test(url)) url = 'https://' + url;
        window.location.href = url;
      }
    });

    // --- (rest of your scripts: popup, cloak, theme, particles, etc.) ---
    // ... (unchanged from previous version) ...
  </script>
</body>
</html>
